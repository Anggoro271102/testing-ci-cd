services:
  # --- 1. BACKEND (PYTHON) ---
  backend:
    image: anggoro2711/my-local-backend:latest
    container_name: backend_app
    restart: unless-stopped
    ports:
      # KITA BUKA PORT LANGSUNG KE WINDOWS
      - "8001:8000"
    networks:
      - local-net
    environment:
      # Izinkan backend menerima request dari mana saja
      - ALLOWED_ORIGINS=*

  # --- 2. FRONTEND (NEXT.JS) ---
  frontend:
    image: anggoro2711/my-local-frontend:latest
    container_name: frontend_app
    restart: unless-stopped
    ports:
      # KITA BUKA PORT LANGSUNG KE WINDOWS
      - "3002:3000"
    networks:
      - local-net
    environment:
      # Penting: Agar Next.js tahu dia berjalan di localhost saat fetch di browser
      - HOSTNAME=0.0.0.0
      - NEXT_PUBLIC_API_URL=http://localhost:8001

  # --- 3. WATCHTOWER (AUTO UPDATE) ---
  # Ini tetap kita pakai biar CI/CD tetap jalan
  watchtower:
    image: containrrr/watchtower
    container_name: watchtower
    volumes:
      # Watchtower biasanya lebih pintar menangani socket windows
      - /var/run/docker.sock:/var/run/docker.sock
    command: --interval 30 --cleanup backend_app frontend_app
    environment:
      # --- TAMBAHAN PENTING ---
      # Memaksa Watchtower bicara dengan bahasa API terbaru
      - DOCKER_API_VERSION=1.45

# --- HAPUS SERVICE TRAEFIK ---

networks:
  local-net:
    name: local-net
